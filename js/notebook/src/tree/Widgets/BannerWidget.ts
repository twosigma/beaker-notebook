/*
 *  Copyright 2017 TWO SIGMA OPEN SOURCE, LLC
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */

import * as $ from 'jquery';

import { Widget } from "@phosphor/widgets";

import BeakerXApi from "../Utils/BeakerXApi";

export default class BannerWidget extends Widget {

  static readonly GITHUB_RELEASE_TAG_BASE_URL = 'https://github.com/twosigma/beakerx/releases/tag/';
  static readonly SVG_LOGO = `
<svg xmlns="http://www.w3.org/2000/svg" width="70pt" height="20pt" viewBox="0 0 70 20" version="1.1">
    <g id="surface1">
        <path style="fill:#0000000;" d="M 3.761719 3.445312 C 2.816406 3.445312 2.046875 2.675781 2.046875 1.722656 C 2.046875 0.773438 2.816406 0 3.761719 0 C 4.710938 0 5.480469 0.773438 5.480469 1.722656 C 5.476562 2.675781 4.710938 3.445312 3.761719 3.445312 Z M 3.761719 0.46875 C 3.078125 0.46875 2.519531 1.027344 2.519531 1.714844 C 2.519531 2.40625 3.074219 2.964844 3.761719 2.964844 C 4.449219 2.960938 5.003906 2.402344 5.003906 1.714844 C 4.992188 1.035156 4.441406 0.488281 3.761719 0.484375 Z M 3.761719 0.46875 "/>
        <path style="fill:#0000000;" d="M 3.035156 6.410156 C 2.492188 6.410156 2.050781 5.96875 2.050781 5.425781 C 2.050781 4.878906 2.492188 4.4375 3.03125 4.4375 C 3.574219 4.4375 4.015625 4.878906 4.015625 5.421875 C 4.015625 5.964844 3.578125 6.410156 3.035156 6.410156 Z M 3.035156 4.921875 C 2.753906 4.925781 2.53125 5.160156 2.535156 5.441406 C 2.539062 5.722656 2.773438 5.945312 3.054688 5.941406 C 3.332031 5.933594 3.554688 5.703125 3.550781 5.421875 C 3.550781 5.285156 3.496094 5.152344 3.398438 5.058594 C 3.300781 4.960938 3.171875 4.910156 3.035156 4.910156 Z M 3.035156 4.921875 "/>
        <path style="fill:#0000000;" d="M 7.804688 6.40625 C 6.652344 6.40625 5.714844 5.46875 5.714844 4.3125 C 5.714844 3.152344 6.648438 2.214844 7.800781 2.214844 C 8.953125 2.214844 9.890625 3.152344 9.890625 4.308594 C 9.886719 5.464844 8.957031 6.402344 7.804688 6.40625 Z M 7.804688 2.683594 C 6.914062 2.683594 6.191406 3.410156 6.191406 4.304688 C 6.191406 5.195312 6.914062 5.921875 7.804688 5.921875 C 8.695312 5.921875 9.417969 5.195312 9.417969 4.304688 C 9.410156 3.414062 8.691406 2.695312 7.804688 2.691406 Z M 7.804688 2.683594 "/>
        <path style="fill:#0000000;" d="M 0.175781 19.125 L 0.175781 5.289062 L 0.652344 5.289062 L 0.652344 18.921875 L 1.285156 19.523438 L 10.613281 19.523438 L 11.253906 18.925781 L 11.253906 7.058594 L 13.09375 5.125 L 13.4375 5.453125 L 11.726562 7.25 L 11.726562 19.132812 L 10.800781 20 L 1.09375 20 Z M 0.175781 19.125 "/>
        <path style="fill:#0000000;" d="M 10.265625 18.476562 L 1.671875 18.476562 L 1.671875 7.789062 L 10.265625 7.789062 Z M 2.148438 18 L 9.789062 18 L 9.789062 8.265625 L 2.148438 8.265625 Z M 2.148438 18 "/>
        <path style="fill:#0000000;" d="M 19.902344 7.839844 C 20.46875 7.828125 21.035156 7.890625 21.582031 8.023438 C 22 8.128906 22.394531 8.316406 22.742188 8.574219 C 23.035156 8.800781 23.265625 9.101562 23.410156 9.445312 C 23.554688 9.8125 23.628906 10.207031 23.621094 10.605469 C 23.621094 10.859375 23.582031 11.109375 23.5 11.347656 C 23.414062 11.59375 23.289062 11.820312 23.128906 12.019531 C 22.953125 12.238281 22.746094 12.425781 22.511719 12.578125 C 22.242188 12.753906 21.949219 12.890625 21.636719 12.980469 C 22.414062 13.128906 23 13.40625 23.390625 13.816406 C 23.792969 14.25 24.003906 14.828125 23.976562 15.417969 C 23.980469 15.84375 23.898438 16.261719 23.730469 16.648438 C 23.566406 17.019531 23.324219 17.347656 23.015625 17.609375 C 22.671875 17.890625 22.273438 18.101562 21.847656 18.226562 C 21.332031 18.378906 20.800781 18.453125 20.265625 18.445312 L 16.527344 18.445312 L 16.527344 7.835938 Z M 17.953125 8.972656 L 17.953125 12.59375 L 19.84375 12.59375 C 20.199219 12.601562 20.554688 12.554688 20.894531 12.460938 C 21.164062 12.386719 21.417969 12.261719 21.636719 12.089844 C 21.824219 11.9375 21.976562 11.738281 22.066406 11.515625 C 22.164062 11.277344 22.210938 11.027344 22.210938 10.769531 C 22.210938 10.144531 22.023438 9.6875 21.652344 9.398438 C 21.28125 9.109375 20.703125 8.964844 19.914062 8.964844 Z M 20.234375 17.3125 C 20.589844 17.320312 20.949219 17.273438 21.289062 17.171875 C 21.558594 17.09375 21.804688 16.960938 22.015625 16.777344 C 22.203125 16.609375 22.34375 16.402344 22.433594 16.167969 C 22.523438 15.921875 22.570312 15.660156 22.566406 15.394531 C 22.589844 14.894531 22.375 14.410156 21.984375 14.09375 C 21.59375 13.773438 21.011719 13.613281 20.238281 13.613281 L 17.953125 13.613281 L 17.953125 17.3125 Z M 20.234375 17.3125 "/>
        <path style="fill:#0000000;" d="M 31.71875 17.402344 C 31.550781 17.601562 31.355469 17.777344 31.136719 17.917969 C 30.90625 18.0625 30.664062 18.183594 30.410156 18.277344 C 30.148438 18.371094 29.878906 18.441406 29.609375 18.488281 C 29.335938 18.535156 29.0625 18.558594 28.789062 18.558594 C 28.300781 18.5625 27.816406 18.472656 27.359375 18.296875 C 26.933594 18.125 26.546875 17.863281 26.230469 17.523438 C 25.898438 17.164062 25.648438 16.734375 25.492188 16.269531 C 25.304688 15.714844 25.214844 15.132812 25.226562 14.550781 C 25.222656 14.050781 25.300781 13.554688 25.464844 13.082031 C 25.613281 12.648438 25.847656 12.246094 26.152344 11.902344 C 26.460938 11.5625 26.835938 11.296875 27.253906 11.117188 C 27.714844 10.921875 28.210938 10.824219 28.714844 10.832031 C 29.140625 10.828125 29.5625 10.902344 29.957031 11.058594 C 30.328125 11.203125 30.667969 11.421875 30.945312 11.707031 C 31.234375 12.011719 31.457031 12.375 31.597656 12.769531 C 31.761719 13.226562 31.84375 13.710938 31.832031 14.195312 C 31.847656 14.335938 31.824219 14.480469 31.765625 14.609375 C 31.707031 14.6875 31.613281 14.726562 31.515625 14.714844 L 26.519531 14.714844 C 26.527344 15.132812 26.59375 15.550781 26.714844 15.953125 C 26.816406 16.273438 26.980469 16.574219 27.199219 16.832031 C 27.402344 17.0625 27.65625 17.242188 27.941406 17.355469 C 28.246094 17.476562 28.570312 17.535156 28.898438 17.53125 C 29.1875 17.539062 29.476562 17.5 29.753906 17.417969 C 29.964844 17.351562 30.167969 17.269531 30.367188 17.167969 C 30.515625 17.09375 30.660156 17.011719 30.800781 16.921875 C 30.886719 16.855469 30.988281 16.816406 31.097656 16.804688 C 31.199219 16.800781 31.292969 16.851562 31.347656 16.933594 Z M 30.65625 13.886719 C 30.65625 13.601562 30.613281 13.316406 30.523438 13.042969 C 30.445312 12.800781 30.320312 12.578125 30.15625 12.386719 C 29.988281 12.199219 29.78125 12.054688 29.554688 11.957031 C 28.773438 11.65625 27.890625 11.808594 27.253906 12.355469 C 26.863281 12.773438 26.621094 13.3125 26.566406 13.886719 Z M 30.65625 13.886719 "/>
        <path style="fill:#0000000;" d="M 33.25 12.011719 C 33.636719 11.628906 34.089844 11.324219 34.585938 11.113281 C 35.09375 10.910156 35.632812 10.808594 36.175781 10.816406 C 36.558594 10.808594 36.9375 10.878906 37.289062 11.023438 C 37.601562 11.152344 37.882812 11.351562 38.109375 11.601562 C 38.335938 11.859375 38.507812 12.167969 38.609375 12.496094 C 38.726562 12.871094 38.785156 13.261719 38.78125 13.652344 L 38.78125 18.453125 L 38.199219 18.453125 C 38.09375 18.460938 37.992188 18.4375 37.902344 18.390625 C 37.820312 18.328125 37.765625 18.242188 37.742188 18.140625 L 37.59375 17.429688 C 37.410156 17.601562 37.21875 17.765625 37.015625 17.917969 C 36.832031 18.054688 36.636719 18.175781 36.425781 18.273438 C 36.214844 18.371094 35.996094 18.445312 35.765625 18.496094 C 35.511719 18.546875 35.25 18.574219 34.988281 18.574219 C 34.710938 18.574219 34.433594 18.53125 34.167969 18.449219 C 33.925781 18.371094 33.695312 18.246094 33.503906 18.078125 C 33.308594 17.90625 33.152344 17.695312 33.050781 17.460938 C 32.933594 17.179688 32.878906 16.878906 32.886719 16.574219 C 32.886719 16.269531 32.96875 15.976562 33.128906 15.71875 C 33.324219 15.417969 33.597656 15.171875 33.914062 15.003906 C 34.363281 14.757812 34.839844 14.582031 35.339844 14.480469 C 36.046875 14.328125 36.769531 14.246094 37.492188 14.238281 L 37.492188 13.652344 C 37.492188 13.070312 37.371094 12.628906 37.121094 12.332031 C 36.84375 12.019531 36.4375 11.855469 36.023438 11.882812 C 35.746094 11.875 35.46875 11.914062 35.207031 12.003906 C 35.007812 12.074219 34.820312 12.167969 34.640625 12.277344 C 34.480469 12.378906 34.34375 12.472656 34.226562 12.550781 C 34.128906 12.628906 34.007812 12.671875 33.882812 12.675781 C 33.800781 12.675781 33.722656 12.652344 33.65625 12.605469 C 33.589844 12.554688 33.535156 12.496094 33.492188 12.429688 Z M 37.492188 15.078125 C 36.976562 15.089844 36.457031 15.136719 35.945312 15.222656 C 35.589844 15.277344 35.242188 15.378906 34.90625 15.523438 C 34.679688 15.617188 34.480469 15.765625 34.324219 15.960938 C 34.207031 16.121094 34.140625 16.316406 34.140625 16.519531 C 34.136719 16.691406 34.167969 16.867188 34.234375 17.03125 C 34.292969 17.164062 34.382812 17.285156 34.496094 17.382812 C 34.613281 17.476562 34.746094 17.542969 34.890625 17.582031 C 35.046875 17.625 35.210938 17.644531 35.371094 17.644531 C 35.585938 17.644531 35.796875 17.621094 36.007812 17.574219 C 36.195312 17.527344 36.378906 17.460938 36.550781 17.371094 C 36.722656 17.28125 36.886719 17.171875 37.039062 17.050781 C 37.199219 16.921875 37.351562 16.78125 37.492188 16.628906 Z M 37.492188 15.078125 "/>
        <path style="fill:#0000000;" d="M 42.097656 7.542969 L 42.097656 13.964844 L 42.4375 13.964844 C 42.519531 13.964844 42.605469 13.953125 42.683594 13.921875 C 42.765625 13.882812 42.835938 13.828125 42.894531 13.753906 L 45.261719 11.21875 C 45.320312 11.140625 45.394531 11.074219 45.476562 11.023438 C 45.570312 10.96875 45.675781 10.945312 45.78125 10.949219 L 46.972656 10.949219 L 44.214844 13.886719 C 44.097656 14.042969 43.953125 14.175781 43.789062 14.277344 C 43.875 14.335938 43.957031 14.40625 44.027344 14.480469 C 44.101562 14.5625 44.171875 14.652344 44.230469 14.742188 L 47.152344 18.449219 L 45.976562 18.449219 C 45.878906 18.449219 45.777344 18.429688 45.6875 18.390625 C 45.597656 18.347656 45.523438 18.277344 45.476562 18.1875 L 43.019531 15.113281 C 42.96875 15.03125 42.894531 14.960938 42.804688 14.910156 C 42.699219 14.875 42.585938 14.859375 42.476562 14.863281 L 42.105469 14.863281 L 42.105469 18.449219 L 40.785156 18.449219 L 40.785156 7.542969 Z M 42.097656 7.542969 "/>
        <path style="fill:#0000000;" d="M 53.917969 17.402344 C 53.753906 17.601562 53.558594 17.777344 53.335938 17.917969 C 53.109375 18.0625 52.867188 18.183594 52.609375 18.277344 C 52.351562 18.371094 52.082031 18.441406 51.808594 18.488281 C 51.539062 18.535156 51.265625 18.558594 50.992188 18.558594 C 50.503906 18.5625 50.015625 18.472656 49.5625 18.296875 C 49.136719 18.125 48.75 17.863281 48.433594 17.523438 C 48.101562 17.164062 47.851562 16.734375 47.691406 16.269531 C 47.507812 15.714844 47.417969 15.132812 47.425781 14.550781 C 47.425781 14.050781 47.507812 13.554688 47.671875 13.082031 C 47.820312 12.648438 48.054688 12.246094 48.359375 11.902344 C 48.664062 11.5625 49.039062 11.296875 49.460938 11.117188 C 49.921875 10.921875 50.417969 10.824219 50.917969 10.832031 C 51.34375 10.828125 51.765625 10.902344 52.164062 11.058594 C 52.535156 11.203125 52.871094 11.421875 53.152344 11.707031 C 53.441406 12.011719 53.660156 12.375 53.800781 12.769531 C 53.964844 13.226562 54.042969 13.710938 54.035156 14.195312 C 54.046875 14.335938 54.023438 14.480469 53.96875 14.609375 C 53.910156 14.6875 53.816406 14.726562 53.71875 14.714844 L 48.726562 14.714844 C 48.730469 15.132812 48.796875 15.550781 48.917969 15.953125 C 49.019531 16.273438 49.183594 16.574219 49.402344 16.832031 C 49.605469 17.0625 49.859375 17.242188 50.144531 17.355469 C 50.449219 17.476562 50.777344 17.535156 51.105469 17.53125 C 51.394531 17.539062 51.679688 17.5 51.957031 17.417969 C 52.167969 17.351562 52.375 17.269531 52.574219 17.167969 C 52.722656 17.09375 52.867188 17.011719 53.003906 16.921875 C 53.09375 16.855469 53.195312 16.816406 53.304688 16.804688 C 53.402344 16.800781 53.496094 16.851562 53.554688 16.933594 Z M 52.859375 13.886719 C 52.863281 13.601562 52.820312 13.316406 52.730469 13.042969 C 52.652344 12.800781 52.527344 12.578125 52.359375 12.386719 C 52.191406 12.199219 51.980469 12.050781 51.75 11.953125 C 50.96875 11.652344 50.085938 11.804688 49.449219 12.355469 C 49.058594 12.773438 48.820312 13.3125 48.769531 13.886719 Z M 52.859375 13.886719 "/>
        <path style="fill:#0000000;" d="M 56.894531 12.453125 C 57.089844 11.992188 57.386719 11.582031 57.765625 11.25 C 58.117188 10.957031 58.566406 10.800781 59.027344 10.816406 C 59.179688 10.816406 59.332031 10.832031 59.480469 10.867188 C 59.617188 10.898438 59.75 10.953125 59.867188 11.03125 L 59.769531 12.023438 C 59.757812 12.136719 59.660156 12.214844 59.550781 12.210938 C 59.445312 12.207031 59.347656 12.191406 59.246094 12.167969 C 59.097656 12.136719 58.949219 12.121094 58.796875 12.121094 C 58.582031 12.117188 58.367188 12.152344 58.167969 12.226562 C 57.984375 12.292969 57.8125 12.398438 57.671875 12.53125 C 57.515625 12.679688 57.386719 12.851562 57.28125 13.039062 C 57.15625 13.257812 57.050781 13.484375 56.964844 13.722656 L 56.964844 18.464844 L 55.640625 18.464844 L 55.640625 10.949219 L 56.394531 10.949219 C 56.5 10.9375 56.605469 10.96875 56.6875 11.03125 C 56.753906 11.109375 56.792969 11.210938 56.800781 11.3125 Z M 56.894531 12.453125 "/>
        <path style="fill:#0000000;" d="M 64.832031 14.773438 L 62.195312 18.464844 L 61.136719 18.464844 L 64.304688 14.03125 L 64.1875 13.867188 L 60.902344 18.464844 L 59.84375 18.464844 L 63.660156 13.125 L 59.871094 7.824219 L 60.929688 7.824219 L 64.1875 12.386719 L 64.71875 13.125 L 64.835938 13.289062 L 65.363281 14.03125 L 68.53125 18.464844 L 67.472656 18.464844 Z M 64.832031 14.773438 "/>
        <path style="fill:#0000000;" d="M 65.480469 13.867188 L 64.949219 13.125 L 64.835938 12.964844 L 64.304688 12.222656 L 61.160156 7.824219 L 62.21875 7.824219 L 64.832031 11.484375 L 67.449219 7.824219 L 68.507812 7.824219 L 65.363281 12.222656 L 65.480469 12.386719 L 68.742188 7.824219 L 69.800781 7.824219 L 66.007812 13.125 L 69.824219 18.464844 L 68.765625 18.464844 Z M 65.480469 13.867188 "/>
    </g>
</svg>  
`;

  constructor(api: BeakerXApi) {
    super();

    this.addClass('bx-banner-widget');

    api
      .getVersion()
      .then((version) => {
          this.createBanner(version);
      });
  }

  private createBanner(version: string): void {
    $(this.node)
      .empty()
      .append(
        this.createLinkedBannerElementRow(),
        document.createTextNode(' version '),

        $('<a>', {
          target: '_blank',
          href: `${BannerWidget.GITHUB_RELEASE_TAG_BASE_URL}${version}`,
          text: version
        }),

        document.createTextNode(', from '),

        $('<a>', {
          target: '_blank',
          href: 'http://opensource.twosigma.com/',
          text: 'Two Sigma Open Source',
        }),

      );
  }

  private createLinkedBannerElementRow() {
    return $('<a>', {
      class: 'beakerx_site_link',
      target: '_blank',
      href: 'http://BeakerX.com',
    }).append(
      $(`${BannerWidget.SVG_LOGO}`)
    );
  }

}
